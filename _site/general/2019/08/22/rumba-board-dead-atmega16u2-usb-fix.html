<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Rumba Board - Dead atmega16u2 (USB) fix | DeeEmm</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Rumba Board - Dead atmega16u2 (USB) fix" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Way back in 2013 I bought a Rumba board for my 3DR printer build. Unfortunately it had a bit if an issue with the USB chip and so the unreliable USB connectivity made it practically unusable. As far as I recall I could never even get a program loaded up, so it&#39;s been sitting in the original box that it shipped in ever since. Cue&nbsp;2019 and I&#39;ve been putting together an MPCNC for a project and decided that I&#39;d really like to get the Rumba board up and running so that I can take advantage of the six stepper drivers it has. Back in 2013, for whatever reason I never bothered to try and fix the issue with&nbsp;the Rumba board, and so it sat on the shelf unloved and unused. I think I managed to get as far as realising that I was not alone with Rumba USB issues as others were experiencing the same problem as me. Unfortunately, whilst there was some comraderie in shared pain, no one had any answers for me as not only was my Rumba board broken, but I also used a Mac, which meant that there was zero pooled experience to draw upon. I was on my own. And so the net result was that it probably went into the too hard basket&nbsp;to wait for another day.&nbsp;Well it&#39;s reprieve came this week when I decided to take a look at trying to revive it.I ordered a USBasp programming interface so that I could re-flash the firmware in the USB controller. The USB comms is handled by an&nbsp;atmega16u2, which can be re-flashed if required. The process is not super difficult but existing online tutorials do not explain things too well.You&#39;ll need a six pin connector for your USBasp programmer to mate with the ICSP header on the Rumba. If, like me your USBasp lead comes with a 10 pin plug you can easily make a temporary adaptor from some male / female jumper wires using the following pin outs" />
<meta property="og:description" content="Way back in 2013 I bought a Rumba board for my 3DR printer build. Unfortunately it had a bit if an issue with the USB chip and so the unreliable USB connectivity made it practically unusable. As far as I recall I could never even get a program loaded up, so it&#39;s been sitting in the original box that it shipped in ever since. Cue&nbsp;2019 and I&#39;ve been putting together an MPCNC for a project and decided that I&#39;d really like to get the Rumba board up and running so that I can take advantage of the six stepper drivers it has. Back in 2013, for whatever reason I never bothered to try and fix the issue with&nbsp;the Rumba board, and so it sat on the shelf unloved and unused. I think I managed to get as far as realising that I was not alone with Rumba USB issues as others were experiencing the same problem as me. Unfortunately, whilst there was some comraderie in shared pain, no one had any answers for me as not only was my Rumba board broken, but I also used a Mac, which meant that there was zero pooled experience to draw upon. I was on my own. And so the net result was that it probably went into the too hard basket&nbsp;to wait for another day.&nbsp;Well it&#39;s reprieve came this week when I decided to take a look at trying to revive it.I ordered a USBasp programming interface so that I could re-flash the firmware in the USB controller. The USB comms is handled by an&nbsp;atmega16u2, which can be re-flashed if required. The process is not super difficult but existing online tutorials do not explain things too well.You&#39;ll need a six pin connector for your USBasp programmer to mate with the ICSP header on the Rumba. If, like me your USBasp lead comes with a 10 pin plug you can easily make a temporary adaptor from some male / female jumper wires using the following pin outs" />
<link rel="canonical" href="http://localhost:4000/general/2019/08/22/rumba-board-dead-atmega16u2-usb-fix.html" />
<meta property="og:url" content="http://localhost:4000/general/2019/08/22/rumba-board-dead-atmega16u2-usb-fix.html" />
<meta property="og:site_name" content="DeeEmm" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-08-22T13:07:01+09:30" />
<script type="application/ld+json">
{"description":"Way back in 2013 I bought a Rumba board for my 3DR printer build. Unfortunately it had a bit if an issue with the USB chip and so the unreliable USB connectivity made it practically unusable. As far as I recall I could never even get a program loaded up, so it&#39;s been sitting in the original box that it shipped in ever since. Cue&nbsp;2019 and I&#39;ve been putting together an MPCNC for a project and decided that I&#39;d really like to get the Rumba board up and running so that I can take advantage of the six stepper drivers it has. Back in 2013, for whatever reason I never bothered to try and fix the issue with&nbsp;the Rumba board, and so it sat on the shelf unloved and unused. I think I managed to get as far as realising that I was not alone with Rumba USB issues as others were experiencing the same problem as me. Unfortunately, whilst there was some comraderie in shared pain, no one had any answers for me as not only was my Rumba board broken, but I also used a Mac, which meant that there was zero pooled experience to draw upon. I was on my own. And so the net result was that it probably went into the too hard basket&nbsp;to wait for another day.&nbsp;Well it&#39;s reprieve came this week when I decided to take a look at trying to revive it.I ordered a USBasp programming interface so that I could re-flash the firmware in the USB controller. The USB comms is handled by an&nbsp;atmega16u2, which can be re-flashed if required. The process is not super difficult but existing online tutorials do not explain things too well.You&#39;ll need a six pin connector for your USBasp programmer to mate with the ICSP header on the Rumba. If, like me your USBasp lead comes with a 10 pin plug you can easily make a temporary adaptor from some male / female jumper wires using the following pin outs","@type":"BlogPosting","headline":"Rumba Board - Dead atmega16u2 (USB) fix","dateModified":"2019-08-22T13:07:01+09:30","datePublished":"2019-08-22T13:07:01+09:30","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/general/2019/08/22/rumba-board-dead-atmega16u2-usb-fix.html"},"url":"http://localhost:4000/general/2019/08/22/rumba-board-dead-atmega16u2-usb-fix.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="DeeEmm" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">DeeEmm</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/archives/">Archives</a><a class="page-link" href="/blog/">Blog</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Rumba Board - Dead atmega16u2 (USB) fix</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-08-22T13:07:01+09:30" itemprop="datePublished">Aug 22, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <div class="ebd-block  " data-type="text"><p>Way back in 2013 I bought a Rumba board for my 3DR printer build. Unfortunately it had a bit if an issue with the USB chip and so the unreliable USB connectivity made it practically unusable. As far as I recall I could never even get a program loaded up, so it's been sitting in the original box that it shipped in ever since. Cue&nbsp;2019 and I've been putting together an MPCNC for a project and decided that I'd really like to get the Rumba board up and running so that I can take advantage of the six stepper drivers it has.<br /><br /></p></div>
<div class="ebd-block  " data-type="readmore"></div>
<div class="ebd-block  " data-type="text"><p>Back in 2013, for whatever reason I never bothered to try and fix the issue with&nbsp;the Rumba board, and so it sat on the shelf unloved and unused. I think I managed to get as far as realising that I was not alone with Rumba USB issues as others were experiencing the same problem as me. Unfortunately, whilst there was some comraderie in shared pain, no one had any answers for me as not only was my Rumba board broken, but I also used a Mac, which meant that there was zero pooled experience to draw upon. I was on my own. And so the net result was that it probably went into the <em data-redactor-tag="em" data-verified="redactor">too hard basket</em>&nbsp;to wait for another day.&nbsp;Well it's reprieve came this week when I decided to take a look at trying to revive it.<br /></p><p>I ordered a USBasp programming interface so that I could re-flash the firmware in the USB controller. The USB comms is handled by an&nbsp;atmega16u2, which can be re-flashed if required. The process is not super difficult but existing online tutorials do not explain things too well.<br /><br />You'll need a six pin connector for your USBasp programmer to mate with the ICSP header on the Rumba. If, like me your USBasp lead comes with a 10 pin plug you can easily make a temporary adaptor from some male / female jumper wires using the following pin outs</p><p><br /></p></div>
<div class="ebd-block  " data-type="image" style="text-align: center;"><div class="eb-image style-clear">
	<div class="eb-image-figure is-responsive">

		
					<a class="eb-image-viewport">
					<img src="../../../images/easyblog_articles/330/b2ap3_small_F7DVN07GGPEXZAI.LARGE.jpg" />
		</a>
	</div>
				</div></div>
<div class="ebd-block  " data-type="text"><p>With the lead made up you can plug it into the Rumba board in the ICSP header nearest to the USB port. It's worth noting that the MISO pin (pin 1) is nearest to the USB port</p><p>Most of the online tutorials state that you must use a program called '<span class="s1" data-redactor-tag="span" data-redactor-class="s1" data-verified="redactor">dfu-programmer'</span>&nbsp;which is available on all platforms. I tried to use this and could not get it to work. In fact I could not even get it to recognise that it had a device plugged into it. So best to&nbsp;just ignore&nbsp;<span class="s1" data-redactor-tag="span" data-redactor-class="s1" data-verified="redactor">dfu-programmer all together.<br />Instead I used avrdude. There's a version of this that's used by the Arduino IDE, but you'll need the command line version, which means installing it. For me (on a mac) I installed it via homebrew with the command <span class="s1" data-redactor-tag="span" data-redactor-class="s1" data-verified="redactor"><strong data-redactor-tag="strong" data-verified="redactor"><em data-redactor-tag="em" data-verified="redactor">brew install avrdude</em></strong></span></span></p><p><span class="s1" data-redactor-tag="span" data-redactor-class="s1" data-verified="redactor"><span class="s1" data-redactor-tag="span" data-redactor-class="s1" data-verified="redactor"><span>​I also installed lsusb which allows you to easily view connected USB devices using the following command&nbsp;<strong data-verified="redactor" data-redactor-tag="strong">​<em data-verified="redactor" data-redactor-tag="em">​     <span class="s1" data-redactor-tag="span" data-redactor-class="s1" data-verified="redactor">brew update &amp;&amp; brew tap jlhonora/lsusb &amp;&amp; brew install lsusb</span></em></strong></span></span></span></p><p><span class="s1" data-redactor-tag="span" data-redactor-class="s1" data-verified="redactor"><span class="s1" data-redactor-tag="span" data-redactor-class="s1" data-verified="redactor"><span><span>To reflash the&nbsp;atmega16u2 you need to download the hex file from the RepRap site -&nbsp;https://reprap.org/wiki/File:RRD-RUMBA_ATmega16U2_USB2Serial.hex.zip Unzip it and then open the directory in&nbsp;a terminal window.&nbsp;</span></span></span></span></p><p><span class="s1" data-redactor-tag="span" data-redactor-class="s1" data-verified="redactor"><span class="s1" data-redactor-tag="span" data-redactor-class="s1" data-verified="redactor"><span><span>I found that there's no need to put the chip into any kind of loader mode, simply issue the following command and it will upload the hex file to the chip</span></span></span></span></p><p>     <span class="s1" data-redactor-tag="span" data-redactor-class="s1" data-verified="redactor">udo avrdude -c usbasp -p m16u2 -F -U flash:r:RRD-RUMBA_ATmega16U2_USB2Serial.hex:i</span><br /></p><p><span class="s1" data-redactor-tag="span" data-redactor-class="s1" data-verified="redactor">Where&nbsp;RRD-RUMBA_ATmega16U2_USB2Serial.hex is the name of the hex file you downloaded</span></p><p><span class="s1" data-redactor-tag="span" data-redactor-class="s1" data-verified="redactor">You will then see some progress indicators in the terminal and a success message when the job is done</span></p></div>
<div class="ebd-block  " data-type="heading"><h2>
	<span>But does it work?&nbsp;</span>
</h2></div>
<div class="ebd-block  " data-type="text"><p><span>Unfortunately whilst uploading the firmware to my chip was actually&nbsp;successful, I did&nbsp;not regain USB functionality. I figured that there must be some other issue with the chip or board. Quite probably it's the clock crystal or maybe&nbsp;some other design problem. So, back to the drawing board I went,&nbsp;as they say.</span><br /></p><p>I figured that whilst I could not use the USB port, if I could upload the sketch to the board&nbsp;then at least I should be able to use the SD card reader in the display to transfer files. I used this method for many years on my 3DR printer as the USB was so flakey (another marginally better&nbsp;Rumba Board), plus&nbsp;then it would also be impervious to issues related to being tethered to a computer, so a win-win really.</p><p>I initially tried to figure out how to use the CLI version of&nbsp;avrdude to upload a compiled sketch but then realised that I should be able to upload via the Arduino IDE. It ended up actually being very simple.</p><p>The programming lead needs to be connected to the ICSP header adjacent to the Stepper driver for Axis X. The Arrow shown by the silk screen points to the MISO pin, you also need to completely remove the USB / Stand-alone&nbsp;power jumper as leaving this in place prevents the transfer from working.</p><p>Next, in the arduino IDE you need to change the settings for 'Tools &gt; Programmer' to 'USBasp'</p><p>Then once you've set your board and processor settings to 'Mega2560', go to the 'Sketch menu and select 'Upload Using Programmer'. The sketch will then&nbsp;compile and upload.</p><p>Power-off and remove the programmer and then replace the power jumper and&nbsp;power up your board to see the 'Marlin' splash screen.</p><p>Assuming you have set up a screen and SD Card interface you can now use your Rumba without needing the USB port.</p></div>
<div class="ebd-block  " data-type="heading"><h2>
	<span>But what if you hate SD cards?<br /></span></h2></div>
<div class="ebd-block  " data-type="text"><p>If, like me you're using your Rumba for a CNC, or your workflow just doesn't work with having to use an SD card then you will need to find out a way to get serial comms to the board. Fortunately they have made this pretty easy on the board that I had by providing a serial header connection. This is the row of four pins adjacent to the USB port (or heater MOSFET on my earlier board). This header is labelled TX / RX /&nbsp;GND / +5V. It is the same pin configuration used on the common bluetooth serial adaptors that you can buy from ebay like the HC-05 or HC-06. So after a little soldering to change the pins on my HC-06 to pin-sockets, I plugged the adaptor in and connected to it from my computer.<br /><br />After pairing with the device,&nbsp;I then opened up CNCjs and selected the new bluetooth serial port from the drop down list and hit open connection.&nbsp;<span>Hey-presto. I can now communicate with my MPCNC from my M</span><span>acbook Via bluetooth.&nbsp; You could also use a USB serial programmer to do the same and regain a physical USB connection should you wish.</span></p><p><br /></p></div>
<div class="ebd-block  " data-type="heading"><h2>
	<span>Conclusion&nbsp;</span>
</h2></div>
<div class="ebd-block  " data-type="text"><p>So, whilst I don't have a working physical USB connection on my board, I'm pretty confident that I will be able to use the machine without it. Unfortunately CNCjs does not seem to have a method by which I can transfer direct to the SD card via the CNCjs interface, which for me would be perfect, but that is easy enough to live without. I'm very happy that I can use CNCjs to jog and set up the machine or simply run GCode from the SD card. Bluetooth is a bonus.<br /><br />One caveat is that it does not appear to be possible to upload a sketch via the bluetooth board&nbsp;/ serial header. This is most likely an issue related to the hardware&nbsp;reset signal required to put the chip into bootloader mode. There's probably workarounds for this (I tried the reset button&nbsp;flick trick but to no avail) but for the reality is that there's probably little need for this functionality when it is so simple to upload via the ICSP header.<br /><br />I hope that this info helps someone out.<br /><br /><br /><br /></p></div>

  </div><a class="u-url" href="/general/2019/08/22/rumba-board-dead-atmega16u2-usb-fix.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">DeeEmm</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">DeeEmm</li><li><a class="u-email" href="mailto:deeemmm@deeemm.com">deeemmm@deeemm.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/DeeEmm"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">DeeEmm</span></a></li><li><a href="https://www.twitter.com/DeeEmm__"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">DeeEmm__</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Waxing lyrical about life the universe and everything tech related since lunchtime 2006.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
