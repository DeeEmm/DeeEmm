<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Joomla / JomSocial - Import user galleries from Geeklog / GLFusion Media Gallery (MG) | DeeEmm</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Joomla / JomSocial - Import user galleries from Geeklog / GLFusion Media Gallery (MG)" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="If you are using Media Gallery to provide image handling functionality to your Geeklog site, the following will help you migrate your images. Media gallery is now an integral part of GLfusion, and so the same principles should apply to GLFusion too. If you are using 4Images, it is possible to migrate to Media Gallery, using the media gallery import functions, or alternatively you may modify the code below to migrate direct. The version of Media Gallery that I have migrated from is 1.5.1. and is no longer available as a stand alone plugin. However, a diligent web search will likely be able to turn up a version.So.... On with the migration.The first thing to do is to copy the following tables from your old geeklog database to your new Joomla database. gl_mg_mediagl_mg_media_albumsgl_mg_albums Once these have been copied over, you can start to migrate the data. &nbsp; First up we copy the image info over INSERT INTO `jos_community_photos` (albumid, caption, published, creator, permissions, image, thumbnail, original, created, hits)SELECTb.album_id,a.`media_title`,&#39;1&#39;,c.owner_id,&#39;0&#39;,concat(&#39;images/photos/&#39;,concat(a.media_user_id,concat(&#39;/&#39;,concat(b.album_id,concat(&#39;/&#39;,concat((SELECT media_filename from gl_mg_media WHERE media_id = a.media_id), concat(&#39;.&#39;, a.media_mime_ext))))))),concat(&#39;images/photos/&#39;,concat(a.media_user_id,concat(&#39;/&#39;,concat(b.album_id,concat(&#39;/thumb_&#39;,concat((SELECT media_filename from gl_mg_media WHERE media_id = a.media_id), concat(&#39;.&#39;, a.media_mime_ext))))))),concat(&#39;images/originalphotos/&#39;,concat(a.media_user_id,concat(&#39;/&#39;,concat(b.album_id,concat(&#39;/&#39;,(SELECT media_filename from gl_mg_media WHERE media_id = a.media_id), concat(&#39;.&#39;, a.media_mime_ext)))))),a.media_upload_time,a.media_viewsFROM gl_mg_media aJOIN gl_mg_media_albums b ON b.media_id = a.media_idJOIN gl_mg_albums c ON c.album_id = b.album_idWHERE c.album_parent=&#39;45&#39; Next the album info... insert into jos_community_photos_albums (id, photoid, creator, name, description, permissions, path, type,hits)SELECT album_id, &#39;&#39;, owner_id, album_title, album_desc, &#39;0&#39;, concat(&#39;images/photos/&#39;,concat( owner_id, &#39;/&#39;)), &#39;user&#39;, album_views from gl_mg_albums WHERE album_parent = &#39;45&#39; &nbsp; And finally, we set the album cover image //set gallery default image (arbitrary image)UPDATE jos_community_photos_albums a, jos_community_photos bSET a.`photoid` = b.idWHERE a.`creator` = b.`creator`AND a.`photoid` =&#39;0&#39; &nbsp; Once done all that is left is to copy the images into the correct location. This is done with the aid of a bit of PHP code. The images need to be organised into the proper folder hierarchy, which involves interrogating the database, creating the relevant folder structure, and then copying the images.Points to note... Be sure to change the database login details + database name If not on the same domain, you will need to copy the existing /images/mediaobjects/orig/ contents across. Correct folder permission will need to be granted to allow the script to create the folders. &nbsp; //copy functionfunction copyemz($file1,$file2){ $contentx =@file_get_contents($file1); $openedfile = fopen($file2, &quot;w&quot;); fwrite($openedfile, $contentx); fclose($openedfile); if ($contentx === FALSE) { $status=false; }else $status=true; return $status; } //estabish database connection$con = mysql_connect(&#39;localhost&#39;,&#39;USER&#39;,&#39;PASSWORD&#39;);if (!$con) { die(&#39;Could not connect: &#39; . mysql_error()); }mysql_select_db(&#39;DATABASENAME&#39;, $con);//get filename from database$result = mysql_query(&quot;SELECT Image FROM jos_community_photos&quot;);while($row = mysql_fetch_array($result)) { //generate filenames + paths $strpart = explode(&#39;/&#39;, $row[&#39;Image&#39;]); $filename = $strpart[4]; $filepath = explode($filename, $row[&#39;Image&#39;]); $sourcepart = explode( &#39;_&#39;, $filename); //get current directory $thisdir = getcwd(); //get filename and directory $SourceFile = &#39;images/mediaobjects/orig/&#39; . $sourcepart[0] . &#39;/&#39; . $filename; $DestFile = $row[&#39;Image&#39;]; $DestPath = $thisdir . &#39;/images/photos/&#39; . $strpart[2] . &#39;/&#39; . $strpart[3]; //create user directory if(mkdir($DestPath , 0777, true)) { echo &quot;Directory $DestPath has been created successfully...&quot;; } else { echo &quot;Failed to create $DestPath directory...&quot;; } //copy file if (!copyemz($SourceFile, $DestFile)) {&nbsp;&nbsp; &nbsp; echo &quot;failed to copy $DestFile ...&quot;; } else { echo $SourceFile . &#39; -&gt; &#39; . $DestFile . &#39; copied successfully&#39;; } //get filename and directory for thumbnails $SourceFile = &#39;images/mediaobjects/tn/&#39; . $sourcepart[0] . &#39;/&#39; . $filename; $DestFile = &#39;images/photos/&#39; . $strpart[2] . &#39;/&#39; . $strpart[3] . &#39;/thumb_&#39; . $filename; if (!copyemz($SourceFile, $DestFile)) {&nbsp;&nbsp; &nbsp; echo &quot;failed to copy $DestFile ...&quot;; } else { echo $SourceFile . &#39; -&gt; &#39; . $DestFile . &#39; copied successfully&#39;; } //get filename and directory $SourceFile = &#39;images/mediaobjects/orig/&#39; . $sourcepart[0] . &#39;/&#39; . $filename; $DestFile = &#39;images/originalphotos/&#39; . $strpart[2] . &#39;/&#39; . $strpart[3] . &#39;/&#39; . $filename; $DestPath = $thisdir . &#39;/images/originalphotos/&#39; . $strpart[2] . &#39;/&#39; . $strpart[3]; //create user directory if(mkdir($DestPath , 0777, true)) { echo &quot;Directory $DestPath has been created successfully...&quot;; } else { echo &quot;Failed to create $DestPath directory...&quot;; } if (!copyemz($SourceFile, $DestFile)) {&nbsp;&nbsp; &nbsp; echo &quot;failed to copy $DestFile ...&quot;; } else { echo $SourceFile . &#39; -&gt; &#39; . $DestFile . &#39; copied successfully&#39;; } }mysql_close($con);?&gt; Once you have run the script, you should now be able to see all of your users photo albums /DM" />
<meta property="og:description" content="If you are using Media Gallery to provide image handling functionality to your Geeklog site, the following will help you migrate your images. Media gallery is now an integral part of GLfusion, and so the same principles should apply to GLFusion too. If you are using 4Images, it is possible to migrate to Media Gallery, using the media gallery import functions, or alternatively you may modify the code below to migrate direct. The version of Media Gallery that I have migrated from is 1.5.1. and is no longer available as a stand alone plugin. However, a diligent web search will likely be able to turn up a version.So.... On with the migration.The first thing to do is to copy the following tables from your old geeklog database to your new Joomla database. gl_mg_mediagl_mg_media_albumsgl_mg_albums Once these have been copied over, you can start to migrate the data. &nbsp; First up we copy the image info over INSERT INTO `jos_community_photos` (albumid, caption, published, creator, permissions, image, thumbnail, original, created, hits)SELECTb.album_id,a.`media_title`,&#39;1&#39;,c.owner_id,&#39;0&#39;,concat(&#39;images/photos/&#39;,concat(a.media_user_id,concat(&#39;/&#39;,concat(b.album_id,concat(&#39;/&#39;,concat((SELECT media_filename from gl_mg_media WHERE media_id = a.media_id), concat(&#39;.&#39;, a.media_mime_ext))))))),concat(&#39;images/photos/&#39;,concat(a.media_user_id,concat(&#39;/&#39;,concat(b.album_id,concat(&#39;/thumb_&#39;,concat((SELECT media_filename from gl_mg_media WHERE media_id = a.media_id), concat(&#39;.&#39;, a.media_mime_ext))))))),concat(&#39;images/originalphotos/&#39;,concat(a.media_user_id,concat(&#39;/&#39;,concat(b.album_id,concat(&#39;/&#39;,(SELECT media_filename from gl_mg_media WHERE media_id = a.media_id), concat(&#39;.&#39;, a.media_mime_ext)))))),a.media_upload_time,a.media_viewsFROM gl_mg_media aJOIN gl_mg_media_albums b ON b.media_id = a.media_idJOIN gl_mg_albums c ON c.album_id = b.album_idWHERE c.album_parent=&#39;45&#39; Next the album info... insert into jos_community_photos_albums (id, photoid, creator, name, description, permissions, path, type,hits)SELECT album_id, &#39;&#39;, owner_id, album_title, album_desc, &#39;0&#39;, concat(&#39;images/photos/&#39;,concat( owner_id, &#39;/&#39;)), &#39;user&#39;, album_views from gl_mg_albums WHERE album_parent = &#39;45&#39; &nbsp; And finally, we set the album cover image //set gallery default image (arbitrary image)UPDATE jos_community_photos_albums a, jos_community_photos bSET a.`photoid` = b.idWHERE a.`creator` = b.`creator`AND a.`photoid` =&#39;0&#39; &nbsp; Once done all that is left is to copy the images into the correct location. This is done with the aid of a bit of PHP code. The images need to be organised into the proper folder hierarchy, which involves interrogating the database, creating the relevant folder structure, and then copying the images.Points to note... Be sure to change the database login details + database name If not on the same domain, you will need to copy the existing /images/mediaobjects/orig/ contents across. Correct folder permission will need to be granted to allow the script to create the folders. &nbsp; //copy functionfunction copyemz($file1,$file2){ $contentx =@file_get_contents($file1); $openedfile = fopen($file2, &quot;w&quot;); fwrite($openedfile, $contentx); fclose($openedfile); if ($contentx === FALSE) { $status=false; }else $status=true; return $status; } //estabish database connection$con = mysql_connect(&#39;localhost&#39;,&#39;USER&#39;,&#39;PASSWORD&#39;);if (!$con) { die(&#39;Could not connect: &#39; . mysql_error()); }mysql_select_db(&#39;DATABASENAME&#39;, $con);//get filename from database$result = mysql_query(&quot;SELECT Image FROM jos_community_photos&quot;);while($row = mysql_fetch_array($result)) { //generate filenames + paths $strpart = explode(&#39;/&#39;, $row[&#39;Image&#39;]); $filename = $strpart[4]; $filepath = explode($filename, $row[&#39;Image&#39;]); $sourcepart = explode( &#39;_&#39;, $filename); //get current directory $thisdir = getcwd(); //get filename and directory $SourceFile = &#39;images/mediaobjects/orig/&#39; . $sourcepart[0] . &#39;/&#39; . $filename; $DestFile = $row[&#39;Image&#39;]; $DestPath = $thisdir . &#39;/images/photos/&#39; . $strpart[2] . &#39;/&#39; . $strpart[3]; //create user directory if(mkdir($DestPath , 0777, true)) { echo &quot;Directory $DestPath has been created successfully...&quot;; } else { echo &quot;Failed to create $DestPath directory...&quot;; } //copy file if (!copyemz($SourceFile, $DestFile)) {&nbsp;&nbsp; &nbsp; echo &quot;failed to copy $DestFile ...&quot;; } else { echo $SourceFile . &#39; -&gt; &#39; . $DestFile . &#39; copied successfully&#39;; } //get filename and directory for thumbnails $SourceFile = &#39;images/mediaobjects/tn/&#39; . $sourcepart[0] . &#39;/&#39; . $filename; $DestFile = &#39;images/photos/&#39; . $strpart[2] . &#39;/&#39; . $strpart[3] . &#39;/thumb_&#39; . $filename; if (!copyemz($SourceFile, $DestFile)) {&nbsp;&nbsp; &nbsp; echo &quot;failed to copy $DestFile ...&quot;; } else { echo $SourceFile . &#39; -&gt; &#39; . $DestFile . &#39; copied successfully&#39;; } //get filename and directory $SourceFile = &#39;images/mediaobjects/orig/&#39; . $sourcepart[0] . &#39;/&#39; . $filename; $DestFile = &#39;images/originalphotos/&#39; . $strpart[2] . &#39;/&#39; . $strpart[3] . &#39;/&#39; . $filename; $DestPath = $thisdir . &#39;/images/originalphotos/&#39; . $strpart[2] . &#39;/&#39; . $strpart[3]; //create user directory if(mkdir($DestPath , 0777, true)) { echo &quot;Directory $DestPath has been created successfully...&quot;; } else { echo &quot;Failed to create $DestPath directory...&quot;; } if (!copyemz($SourceFile, $DestFile)) {&nbsp;&nbsp; &nbsp; echo &quot;failed to copy $DestFile ...&quot;; } else { echo $SourceFile . &#39; -&gt; &#39; . $DestFile . &#39; copied successfully&#39;; } }mysql_close($con);?&gt; Once you have run the script, you should now be able to see all of your users photo albums /DM" />
<link rel="canonical" href="http://localhost:4000/joomla%201.5%20how%20to's/2011/02/22/joomla-jomsocial-import-user-galleries-from-geeklog-glfusion-media-gallery-mg.html" />
<meta property="og:url" content="http://localhost:4000/joomla%201.5%20how%20to's/2011/02/22/joomla-jomsocial-import-user-galleries-from-geeklog-glfusion-media-gallery-mg.html" />
<meta property="og:site_name" content="DeeEmm" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2011-02-22T23:47:49+10:30" />
<script type="application/ld+json">
{"description":"If you are using Media Gallery to provide image handling functionality to your Geeklog site, the following will help you migrate your images. Media gallery is now an integral part of GLfusion, and so the same principles should apply to GLFusion too. If you are using 4Images, it is possible to migrate to Media Gallery, using the media gallery import functions, or alternatively you may modify the code below to migrate direct. The version of Media Gallery that I have migrated from is 1.5.1. and is no longer available as a stand alone plugin. However, a diligent web search will likely be able to turn up a version.So.... On with the migration.The first thing to do is to copy the following tables from your old geeklog database to your new Joomla database. gl_mg_mediagl_mg_media_albumsgl_mg_albums Once these have been copied over, you can start to migrate the data. &nbsp; First up we copy the image info over INSERT INTO `jos_community_photos` (albumid, caption, published, creator, permissions, image, thumbnail, original, created, hits)SELECTb.album_id,a.`media_title`,&#39;1&#39;,c.owner_id,&#39;0&#39;,concat(&#39;images/photos/&#39;,concat(a.media_user_id,concat(&#39;/&#39;,concat(b.album_id,concat(&#39;/&#39;,concat((SELECT media_filename from gl_mg_media WHERE media_id = a.media_id), concat(&#39;.&#39;, a.media_mime_ext))))))),concat(&#39;images/photos/&#39;,concat(a.media_user_id,concat(&#39;/&#39;,concat(b.album_id,concat(&#39;/thumb_&#39;,concat((SELECT media_filename from gl_mg_media WHERE media_id = a.media_id), concat(&#39;.&#39;, a.media_mime_ext))))))),concat(&#39;images/originalphotos/&#39;,concat(a.media_user_id,concat(&#39;/&#39;,concat(b.album_id,concat(&#39;/&#39;,(SELECT media_filename from gl_mg_media WHERE media_id = a.media_id), concat(&#39;.&#39;, a.media_mime_ext)))))),a.media_upload_time,a.media_viewsFROM gl_mg_media aJOIN gl_mg_media_albums b ON b.media_id = a.media_idJOIN gl_mg_albums c ON c.album_id = b.album_idWHERE c.album_parent=&#39;45&#39; Next the album info... insert into jos_community_photos_albums (id, photoid, creator, name, description, permissions, path, type,hits)SELECT album_id, &#39;&#39;, owner_id, album_title, album_desc, &#39;0&#39;, concat(&#39;images/photos/&#39;,concat( owner_id, &#39;/&#39;)), &#39;user&#39;, album_views from gl_mg_albums WHERE album_parent = &#39;45&#39; &nbsp; And finally, we set the album cover image //set gallery default image (arbitrary image)UPDATE jos_community_photos_albums a, jos_community_photos bSET a.`photoid` = b.idWHERE a.`creator` = b.`creator`AND a.`photoid` =&#39;0&#39; &nbsp; Once done all that is left is to copy the images into the correct location. This is done with the aid of a bit of PHP code. The images need to be organised into the proper folder hierarchy, which involves interrogating the database, creating the relevant folder structure, and then copying the images.Points to note... Be sure to change the database login details + database name If not on the same domain, you will need to copy the existing /images/mediaobjects/orig/ contents across. Correct folder permission will need to be granted to allow the script to create the folders. &nbsp; //copy functionfunction copyemz($file1,$file2){ $contentx =@file_get_contents($file1); $openedfile = fopen($file2, &quot;w&quot;); fwrite($openedfile, $contentx); fclose($openedfile); if ($contentx === FALSE) { $status=false; }else $status=true; return $status; } //estabish database connection$con = mysql_connect(&#39;localhost&#39;,&#39;USER&#39;,&#39;PASSWORD&#39;);if (!$con) { die(&#39;Could not connect: &#39; . mysql_error()); }mysql_select_db(&#39;DATABASENAME&#39;, $con);//get filename from database$result = mysql_query(&quot;SELECT Image FROM jos_community_photos&quot;);while($row = mysql_fetch_array($result)) { //generate filenames + paths $strpart = explode(&#39;/&#39;, $row[&#39;Image&#39;]); $filename = $strpart[4]; $filepath = explode($filename, $row[&#39;Image&#39;]); $sourcepart = explode( &#39;_&#39;, $filename); //get current directory $thisdir = getcwd(); //get filename and directory $SourceFile = &#39;images/mediaobjects/orig/&#39; . $sourcepart[0] . &#39;/&#39; . $filename; $DestFile = $row[&#39;Image&#39;]; $DestPath = $thisdir . &#39;/images/photos/&#39; . $strpart[2] . &#39;/&#39; . $strpart[3]; //create user directory if(mkdir($DestPath , 0777, true)) { echo &quot;Directory $DestPath has been created successfully...&quot;; } else { echo &quot;Failed to create $DestPath directory...&quot;; } //copy file if (!copyemz($SourceFile, $DestFile)) {&nbsp;&nbsp; &nbsp; echo &quot;failed to copy $DestFile ...&quot;; } else { echo $SourceFile . &#39; -&gt; &#39; . $DestFile . &#39; copied successfully&#39;; } //get filename and directory for thumbnails $SourceFile = &#39;images/mediaobjects/tn/&#39; . $sourcepart[0] . &#39;/&#39; . $filename; $DestFile = &#39;images/photos/&#39; . $strpart[2] . &#39;/&#39; . $strpart[3] . &#39;/thumb_&#39; . $filename; if (!copyemz($SourceFile, $DestFile)) {&nbsp;&nbsp; &nbsp; echo &quot;failed to copy $DestFile ...&quot;; } else { echo $SourceFile . &#39; -&gt; &#39; . $DestFile . &#39; copied successfully&#39;; } //get filename and directory $SourceFile = &#39;images/mediaobjects/orig/&#39; . $sourcepart[0] . &#39;/&#39; . $filename; $DestFile = &#39;images/originalphotos/&#39; . $strpart[2] . &#39;/&#39; . $strpart[3] . &#39;/&#39; . $filename; $DestPath = $thisdir . &#39;/images/originalphotos/&#39; . $strpart[2] . &#39;/&#39; . $strpart[3]; //create user directory if(mkdir($DestPath , 0777, true)) { echo &quot;Directory $DestPath has been created successfully...&quot;; } else { echo &quot;Failed to create $DestPath directory...&quot;; } if (!copyemz($SourceFile, $DestFile)) {&nbsp;&nbsp; &nbsp; echo &quot;failed to copy $DestFile ...&quot;; } else { echo $SourceFile . &#39; -&gt; &#39; . $DestFile . &#39; copied successfully&#39;; } }mysql_close($con);?&gt; Once you have run the script, you should now be able to see all of your users photo albums /DM","@type":"BlogPosting","headline":"Joomla / JomSocial - Import user galleries from Geeklog / GLFusion Media Gallery (MG)","dateModified":"2011-02-22T23:47:49+10:30","datePublished":"2011-02-22T23:47:49+10:30","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/joomla%201.5%20how%20to's/2011/02/22/joomla-jomsocial-import-user-galleries-from-geeklog-glfusion-media-gallery-mg.html"},"url":"http://localhost:4000/joomla%201.5%20how%20to's/2011/02/22/joomla-jomsocial-import-user-galleries-from-geeklog-glfusion-media-gallery-mg.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="DeeEmm" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">DeeEmm</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/archives/">Archives</a><a class="page-link" href="/blog/">Blog</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Joomla / JomSocial - Import user galleries from Geeklog / GLFusion Media Gallery (MG)</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2011-02-22T23:47:49+10:30" itemprop="datePublished">Feb 22, 2011
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>If you are using Media Gallery to provide image handling functionality to your Geeklog site, the following will help you migrate your images. Media gallery is now an integral part of GLfusion, and so the same principles should apply to GLFusion too.</p>
<p>If you are using 4Images, it is possible to migrate to Media Gallery, using the media gallery import functions, or alternatively you may modify the code below to migrate direct.</p>
<p>The version of Media Gallery that I have migrated from is 1.5.1. and is no longer available as a stand alone plugin. However, a diligent web search will likely be able to turn up a version.<br /><br />So.... On with the migration.<br /><br />The first thing to do is to copy the following tables from your old geeklog database to your new Joomla database.</p>
<p><strong>gl_mg_media<br />gl_mg_media_albums<br />gl_mg_albums</strong></p>
<p>Once these have been copied over, you can start to migrate the data.</p>
<p>&nbsp;</p>
<p>First up we copy the image info over</p>
<p><em>INSERT INTO `jos_community_photos` (albumid, caption, published, creator, permissions, image, thumbnail, original, created, hits)<br />SELECT<br />b.album_id,<br />a.`media_title`,<br />'1',<br />c.owner_id,<br />'0',<br />concat('images/photos/',concat(a.media_user_id,concat('/',concat(b.album_id,concat('/',concat((SELECT media_filename from gl_mg_media WHERE media_id = a.media_id), concat('.', a.media_mime_ext))))))),<br />concat('images/photos/',concat(a.media_user_id,concat('/',concat(b.album_id,concat('/thumb_',concat((SELECT media_filename from gl_mg_media WHERE media_id = a.media_id), concat('.', a.media_mime_ext))))))),<br />concat('images/originalphotos/',concat(a.media_user_id,concat('/',concat(b.album_id,concat('/',(SELECT media_filename from gl_mg_media WHERE media_id = a.media_id), concat('.', a.media_mime_ext)))))),<br />a.media_upload_time,<br />a.media_views<br />FROM gl_mg_media a<br />JOIN gl_mg_media_albums b ON b.media_id = a.media_id<br />JOIN gl_mg_albums c ON c.album_id = b.album_id<br />WHERE c.album_parent='45'</em></p>
<p><br /><br />Next the album info...</p>
<p><em>insert into jos_community_photos_albums (id, photoid, creator, name, description, permissions, path, type,hits)<br />SELECT album_id, '', owner_id, album_title, album_desc, '0', concat('images/photos/',concat( owner_id, '/')), 'user', album_views from gl_mg_albums WHERE album_parent = '45'</em></p>
<p>&nbsp;</p>
<p>And finally, we set the album cover image</p>
<p><em>//set gallery default image (arbitrary image)<br />UPDATE jos_community_photos_albums a, jos_community_photos b<br />SET a.`photoid` = b.id<br />WHERE a.`creator` = b.`creator`<br />AND a.`photoid` ='0'</em></p>
<p>&nbsp;</p>
<p>Once done all that is left is to copy the images into the correct location. This is done with the aid of a bit of PHP code. The images need to be organised into the proper folder hierarchy, which involves interrogating the database, creating the relevant folder structure, and then copying the images.<br /><br />Points to note...</p>
<ul>
<li>Be sure to change the database login details + database name</li>
<li>If not on the same domain, you will need to copy the existing /images/mediaobjects/orig/ contents across.</li>
<li>Correct folder permission will need to be granted to allow the script to create the folders.</li>
</ul>
<p>&nbsp;</p>
<pre><br /><!--?php     <br ?--> <br />//copy function<br />function copyemz($file1,$file2){ <br /> $contentx =@file_get_contents($file1); <br /> $openedfile = fopen($file2, "w"); <br /> fwrite($openedfile, $contentx); <br /> fclose($openedfile); <br /> if ($contentx === FALSE) { <br /> $status=false; <br /> }else $status=true; <br /> <br /> return $status; <br />} <br /><br />//estabish database connection<br />$con = mysql_connect('localhost','USER','PASSWORD');<br />if (!$con)<br /> {<br /> die('Could not connect: ' . mysql_error());<br /> }<br />mysql_select_db('DATABASENAME', $con);<br /><br /><br />//get filename from database<br />$result = mysql_query("SELECT Image FROM jos_community_photos");<br /><br />while($row = mysql_fetch_array($result))<br /> {<br /> //generate filenames + paths<br /><br /> $strpart = explode('/', $row['Image']);<br /> $filename = $strpart[4];<br /> $filepath = explode($filename, $row['Image']);<br /> <br /> $sourcepart = explode( '_', $filename);<br /> <br /> //get current directory<br /> $thisdir = getcwd(); <br /> <br /> <br /> <br /> //get filename and directory<br /> $SourceFile = 'images/mediaobjects/orig/' . $sourcepart[0] . '/' . $filename;<br /> $DestFile = $row['Image'];<br /> $DestPath = $thisdir . '/images/photos/' . $strpart[2] . '/' . $strpart[3];<br /> <br /> //create user directory<br /> if(mkdir($DestPath , 0777, true)) { <br /> echo "Directory $DestPath has been created successfully...<br />"; <br /> } else { <br /> echo "Failed to create $DestPath directory...<br />"; <br /> }<br /> <br /> //copy file<br /> if (!copyemz($SourceFile, $DestFile)) {&nbsp;&nbsp; &nbsp;<br /> echo "failed to copy $DestFile ...<br />";<br /> } else {<br /> echo $SourceFile . ' -&gt; ' . $DestFile . ' copied successfully<br />';<br /> }<br /><br /> //get filename and directory for thumbnails<br /> $SourceFile = 'images/mediaobjects/tn/' . $sourcepart[0] . '/' . $filename;<br /> $DestFile = 'images/photos/' . $strpart[2] . '/' . $strpart[3] . '/thumb_' . $filename;<br /><br /> if (!copyemz($SourceFile, $DestFile)) {&nbsp;&nbsp; &nbsp;<br /> echo "failed to copy $DestFile ...<br />";<br /> } else {<br /> echo $SourceFile . ' -&gt; ' . $DestFile . ' copied successfully<br />';<br /> }<br /><br /><br /><br /> //get filename and directory<br /> $SourceFile = 'images/mediaobjects/orig/' . $sourcepart[0] . '/' . $filename;<br /> $DestFile = 'images/originalphotos/' . $strpart[2] . '/' . $strpart[3] . '/' . $filename;<br /> $DestPath = $thisdir . '/images/originalphotos/' . $strpart[2] . '/' . $strpart[3];<br /> <br /> //create user directory<br /> if(mkdir($DestPath , 0777, true)) { <br /> echo "Directory $DestPath has been created successfully...<br />"; <br /> } else { <br /> echo "Failed to create $DestPath directory...<br />"; <br /> }<br /><br /> if (!copyemz($SourceFile, $DestFile)) {&nbsp;&nbsp; &nbsp;<br /> echo "failed to copy $DestFile ...<br />";<br /> } else {<br /> echo $SourceFile . ' -&gt; ' . $DestFile . ' copied successfully<br />';<br /> }<br /><br /> <br /> }<br /><br />mysql_close($con);<br /><br />?&gt;</pre>
<p>Once you have run the script, you should now be able to see all of your users photo albums</p>
<p>/DM</p>

  </div><a class="u-url" href="/joomla%201.5%20how%20to's/2011/02/22/joomla-jomsocial-import-user-galleries-from-geeklog-glfusion-media-gallery-mg.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">DeeEmm</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">DeeEmm</li><li><a class="u-email" href="mailto:deeemmm@deeemm.com">deeemmm@deeemm.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/DeeEmm"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">DeeEmm</span></a></li><li><a href="https://www.twitter.com/DeeEmm__"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">DeeEmm__</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Waxing lyrical about life the universe and everything tech related since lunchtime 2006.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
